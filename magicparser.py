import os, magic, argparse, time

start = time.time()

"""
Python script to parse files using python-magic, append them to a text file and create the text file in Documents/temp
"""

# Create argument parser
parser = argparse.ArgumentParser(description='A python-magic parser')
# Add the arguments: Enter filepath(s)
parser.add_argument("dir_path", help="paste path to file")
args = parser.parse_args()
lst = []


def fun1():
    for root, dirs, files in os.walk(args.dir_path, topdown=False):
        for file in files:
            f = os.path.join(root, file)
            output = magic.from_file(f)
            # print(f + " - " + output)
            if "PE32" in output:
                lst.append(output)


end = time.time()


def fun2():
    os.chdir("/home/ldeng/Malware_Analysis/Malware_Analysis_Summer2019/")
    f = open("magic.txt", "w")
    i = f.write("\n".join(lst))
    fun2.i = i


fun1()
fun2()

print("Processing has completed")