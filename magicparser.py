import os, magic, argparse, time

"""
Python script to parse files using python-magic, append them to a text file and create the text file in Documents/temp
"""

# Create argument parser
parser = argparse.ArgumentParser(description='A python-magic parser')
# Add the arguments: Enter filepath(s)
parser.add_argument("dir_path", help="paste path to file")
args = parser.parse_args()
lst = []


def collectPE32MetaData():
    for root, dirs, files in os.walk(args.dir_path, topdown=False):
        for file in files:
            f = os.path.join(root, file)
            output = magic.from_file(f)
            # print(f + " - " + output)
            if "pe32" in output.lower():
                lst.append(output)
    writeOutputToFile(lst, "magic.txt")


def writeOutputToFile(outputArray, fileName):
    os.chdir("/home/ldeng/Malware_Analysis/Malware_Analysis_Summer2019/")
    f = open(fileName, "w")
    f.write("\n".join(outputArray))
    

collectPE32MetaData()